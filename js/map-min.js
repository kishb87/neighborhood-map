function AppViewModel(){function e(e){for(var o,n,s,t=0,a=e.length,r=0;a--;)t+=e[a][1],r+=e[a][2];return o=t/e.length,s=r/e.length,n=[o,s]}function o(o){function n(){for(var e,n,s,t=i;t--;)s=new google.maps.Marker({position:new google.maps.LatLng(o[t][1],o[t][2]),map:r,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}),s.setAnimation(google.maps.Animation.DROP),e=o[t][0],n=new google.maps.InfoWindow({content:e}),google.maps.event.addListener(s,"click",function(e,o,n){return function(){n.setContent(o),n.open(r,e),e.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"),google.maps.event.addListener(r,"click",function(){n.close(),e.setIcon("http://maps.google.com/mapfiles/ms/icons/blue-dot.png")})}}(s,e,n)),c.push({marker:s,infoWindow:n});return c}function s(e){for(var o=i;o--;){var n,s,t,a,c;n=o,s=document.getElementById(n),t=new google.maps.LatLng(e[o][1],e[o][2]),a=new google.maps.Marker({position:t,map:r,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}),c=e[o][0],s.addEventListener("click",function(e,o){return function(){var n=new google.maps.InfoWindow({content:o});n.close(),n.open(r,e),e.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"),google.maps.event.addListener(r,"click",function(){e.setIcon("http://maps.google.com/mapfiles/ms/icons/blue-dot.png"),n.close()})}}(a,c))}}var t,a,r,c,i;t=e(o),i=o.length,a={center:{lat:t[0],lng:t[1]},zoom:12},r=new google.maps.Map(document.getElementById("map-canvas"),a),c=[],results=n(),s(o)}function n(e){function n(){var o=e.businesses.length;for(viewModel.restaurants.removeAll();o--;)viewModel.restaurants.push({name:e.businesses[o].name,rating:e.businesses[o].rating+" Stars",imgurl:e.businesses[o].image_url,address:e.businesses[o].location.address[0],display_phone:e.businesses[o].display_phone,coordinate:e.businesses[o].location.coordinate,url:e.businesses[o].url})}function s(){for(var o,n=e.businesses.length;n--;)o=e.businesses[n],o.location&&o.location.coordinate&&t.push([o.name,o.location.coordinate.latitude,o.location.coordinate.longitude])}var t=[];n(),s(),google.maps.event.addDomListener(window,"load",o(t))}var s,t,a=function(){function e(e){s={consumerKey:"wu3iSseMZMhbIUVQOOxJBw",consumerSecret:"KQ0c4Q3nGe_RaXb_ONn8vX5p3nI",accessToken:"GUaqvCY2AUTQjHbS1JLTzA2cWJncjBMi",accessTokenSecret:"1BmHjlUVlADjBPg_Z1Xndc0IEx4",serviceProvider:{signatureMethod:"HMAC-SHA1"}},terms="tacos",accessor={consumerSecret:s.consumerSecret,tokenSecret:s.accessTokenSecret},e=e?e():"San Francisco, CA",parameters=[],parameters.push(["term",terms]),parameters.push(["location",e]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",s.consumerKey]),parameters.push(["oauth_consumer_secret",s.consumerSecret]),parameters.push(["oauth_token",s.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]),t={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters},OAuth.setTimestampAndNonce(t),OAuth.SignatureMethod.sign(t,accessor);var o=OAuth.getParameterMap(t.parameters);return o}var o,s,t,a;return o=this,a=function(o){$.ajax({url:"http://api.yelp.com/v2/search",data:e(o),dataType:"jsonp",jsonpCallback:"cb",success:function(e){n(e)}})},{request:a}}();return s=this,s.restaurants=ko.observableArray(),s.city=ko.observable(),s.rating=ko.observableArray(),t=s.city,s.select=function(){a.request(t)},a.request(),s}var viewModel=AppViewModel();ko.applyBindings(viewModel);